import{r as i,a as d,j as g,S as et,B as ot,b as st,c as k,C as nt,d as rt,e as at,f as it,J as ct,V as ut,U as lt,F as ht}from"./index-BWg5LSEW.js";import{a as gt,u as J,e as z,d as N,b as pt}from"./currentPageAtom-xAk_Qf4j.js";import{b as w}from"./meshopt_decoder.module-DVGcpq6m.js";const j=["1.Περιεχόμενα_1","2.Περιεχόμενα_2","3.ΓειαΕίμαιΟΜιχάλης","4.ΛίγαΛόγιαΓιαΜένα","5.ΑκαδημαϊκοίΤίτλοι","6.ΕπαγγελματικοίΤίτλοι","7.ΕργασιακήΕμπειρία_1","8.ΕργασιακήΕμπειρία_2","9.Εργοδότες","10.Projects_1","11.Projects_2","12.Projects_3","13.ΞένεςΓλώσσες","14.Hobbies","15.ΣτοιχείαΕπικοινωνίας","16.Credits"],L=gt(0),x=[{front:"book-cover",back:j[0]}];for(let t=1;t<j.length;t+=2)x.push({front:j[t],back:j[t+1]||"book-back"});const ft=.5,dt=.3,xt=.18,mt=.01,kt=.09,_=1.14,Mt=1.71,R=.003,T=30,S=_/T,b=new at(_,Mt,R,T,2);b.translate(_/2,0,0);const U=b.attributes.position,V=new ut,O=[],q=[];for(let t=0;t<U.count;t++){V.fromBufferAttribute(U,t);const c=V.x,u=Math.max(0,Math.floor(c/S));let o=c%S/S;O.push(u,u+1,0,0),q.push(1-o,o,0,0)}b.setAttribute("skinIndex",new lt(O,4));b.setAttribute("skinWeight",new ht(q,4));const P=new nt("white"),Pt=[new k({color:P}),new k({color:"#111"}),new k({color:P}),new k({color:P})];x.forEach(t=>{const c=`/textures/${t.front}.jpg`,u=`/textures/${t.back}.jpg`,o="/textures/book-cover-roughness.jpg";d(c)&&w.preload(c),d(u)&&w.preload(u),d(o)&&w.preload(o)});const bt=({number:t,front:c,back:u,page:o,opened:p,bookClosed:f,...A})=>{const a=`/textures/${c}.jpg`,r=`/textures/${u}.jpg`,s="/textures/book-cover-roughness.jpg";if(!d(a)||!d(r))return console.log("Blocked unsafe texture paths",{frontPath:a}),null;if((t===0||t===x.length-1)&&!d(s))return console.log("Blocked unsafe roughness path",{roughnessPath:s}),null;const[B,G,y]=w([`/textures/${c}.jpg`,`/textures/${u}.jpg`,...t===0||t===x.length-1?["/textures/book-cover-roughness.jpg"]:[]]);B.colorSpace=G.colorSpace=et;const F=i.useRef(),H=i.useRef(0),D=i.useRef(p),I=i.useRef(),K=i.useMemo(()=>{const l=[];for(let h=0;h<=T;h++){let e=new ot;l.push(e),h===0?e.position.x=0:e.position.x=S,h>0&&l[h-1].add(e)}const M=new st(l),m=[...Pt,new k({color:P,map:B,...t===0?{roughnessMap:y}:{roughness:1},emissiveIntensity:0}),new k({color:P,map:G,...t===x.length-1?{roughnessMap:y}:{roughness:1},emissiveIntensity:0})],n=new rt(b,m);return n.castShadow=!0,n.receiveShadow=!0,n.frustumCulled=!1,n.add(M.bones[0]),n.bind(M),n},[]);it((l,M)=>{if(!I.current)return;D.current!==p&&(H.current=+new Date,D.current=p);let m=Math.min(400,new Date-H.current)/400;m=Math.sin(m*Math.PI);let n=p?-Math.PI/2:Math.PI/2;f||(n+=N(t*.8));const h=I.current.skeleton.bones;for(let e=0;e<h.length;e++){const W=e===0?F.current:h[e],X=e<8?Math.sin(e*.2+.25):0,Y=e>=8?Math.cos(e*.3+.09):0,Z=Math.sin(e*Math.PI*(1/h.length))*m;let E=xt*X*n-mt*Y*n+kt*Z*n,C=N(Math.sign(n)*2);f&&(e===0?(E=n,C=0):(E=0,C=0)),z.dampAngle(W.rotation,"y",E,ft,M);const tt=e>8?Math.sin(e*Math.PI*(1/h.length)-.5)*m:0;z.dampAngle(W.rotation,"x",C*tt,dt,M)}});const[wt,Q]=J(L),[$,v]=i.useState(!1);return pt($),g.jsxs(g.Fragment,{children:[$&&g.jsx(ct,{position:[.2,1.51,0],children:g.jsx("div",{style:{width:140,color:"white",background:"black",padding:"10px",borderRadius:"10px",fontSize:"14px",textAlign:"center",fontFamily:"'Delius Swash Caps', cursive"},children:"Scroll to zoom"})}),g.jsx("group",{...A,ref:F,onPointerEnter:l=>{l.stopPropagation(),v(!0)},onPointerLeave:l=>{l.stopPropagation(),v(!1)},onClick:l=>{l.stopPropagation(),Q(p?t:t+1),v(!1)},children:g.jsx("primitive",{object:K,ref:I,"position-z":-t*R+o*R})})]})},It=i.forwardRef(({position:t=[-1.02,.5532,-2.38],...c},u)=>{const[o]=J(L),p=i.useRef(!1);i.useEffect(()=>{const a="/audios/page-flip-01a.mp3";if(!d(a)){console.error("Blocked unsafe audio path:",a);return}if(!p.current){p.current=!0;return}const r=new Audio(a);return r.play().catch(s=>{}),()=>{try{r.pause(),r.src=""}catch(s){console.debug("page flip audio play error:",s)}}},[o]);const[f,A]=i.useState(o);return i.useEffect(()=>{let a;const r=()=>{A(s=>{if(o===s)return s;if(a=setTimeout(()=>{r()},Math.abs(o-s)>2?50:150),o>s)return s+1;if(o<s)return s-1})};return r(),()=>{clearTimeout(a)}},[o]),g.jsx(g.Fragment,{children:g.jsx("group",{ref:u,...c,rotation:[0,Math.PI/2,Math.PI/2],position:t,scale:.27,children:[...x].map((a,r)=>g.jsx(bt,{page:f,number:r,opened:f>r,bookClosed:f===0||f===x.length,...a},r))})})});export{It as Book};
